<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ramallah WebGIS</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<style>
    body, html { margin: 0; padding: 0; height: 100%; }
    #map { height: 100vh; }

    /* ----------- LEGEND (DROP DOWN) ----------- */
    #legend-box {
        position: absolute;
        bottom: 45px;
        left: 10px;
        background: white;
        padding: 10px 14px;
        border-radius: 10px;
        width: 220px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        font-family: Arial;
        z-index: 9998;
    }

    #legend-title {
        font-weight: bold;
        text-align: center;
        font-size: 16px;
        cursor: pointer;
        user-select: none;
    }

    #legend-content {
        display: none;
        margin-top: 8px;
        font-size: 14px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 4px;
    }

    .emoji {
        font-size: 18px;
        width: 22px;
        margin-right: 6px;
    }

    .symbol-line {
        width: 26px;
        height: 4px;
        background: black;
        margin-right: 6px;
    }

    .symbol-poly {
        width: 20px;
        height: 12px;
        background: gray;
        margin-right: 6px;
        border: 1px solid #00000080;
    }

    /* ---------- OPACITY PANEL (DROPDOWN) ---------- */
    #opacity-box {
        position: absolute;
        bottom: 220px;   /* ŸÜÿ≤ŸÑÿ™Ÿá ÿ£ŸÉÿ´ÿ± */
        left: 10px;
        background: white;
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        font-family: Arial;
        width: 220px;
        z-index: 9999;
    }

    #opacity-title {
        font-weight: bold;
        text-align: center;
        margin-bottom: 8px;
        font-size: 15px;
        cursor: pointer;
        user-select: none;
    }

    #opacity-content {
        display: none;
        margin-top: 5px;
    }

    .opacity-item {
        margin-bottom: 12px;
    }

    .opacity-item label {
        font-size: 13px;
        display: block;
        margin-bottom: 4px;
    }

    input[type=range] {
        width: 100%;
    }

    /* -------- SCALE TO CENTER -------- */
    .leaflet-control-scale {
        left: 50% !important;
        transform: translateX(-50%);
        margin: 0 auto !important;
    }
</style>

</head>
<body>

<div id="map"></div>

<!-- OPACITY CONTROL PANEL -->
<div id="opacity-box">
    <div id="opacity-title">Transparency ‚ñº</div>
    <div id="opacity-content">
        <div id="opacity-controls"></div>
    </div>
</div>

<!-- LEGEND -->
<div id="legend-box">
    <div id="legend-title">Legend ‚ñº</div>
    <div id="legend-content">

        <!-- POINT -->
        <div class="legend-item"><span class="emoji">üè´</span> Schools (Point)</div>
        <div class="legend-item"><span class="emoji">üíß</span> Wells (Point)</div>
        <div class="legend-item"><span class="emoji">‚õèÔ∏è</span> Quarries (Point)</div>

        <hr>

        <!-- LINE -->
        <div class="legend-item"><span class="symbol-line"></span> Roads</div>
        <div class="legend-item"><span class="symbol-line"></span> Streams</div>
        <div class="legend-item"><span class="symbol-line"></span> Annexation Wall</div>

        <hr>

        <!-- POLYGON -->
        <div class="legend-item"><span class="symbol-poly"></span> Agricultural Land</div>
        <div class="legend-item"><span class="symbol-poly"></span> Closed Areas</div>
        <div class="legend-item"><span class="symbol-poly"></span> Built-up Areas</div>
        <div class="legend-item"><span class="symbol-poly"></span> Master Plans</div>
        <div class="legend-item"><span class="symbol-poly"></span> Settlements</div>
        <div class="legend-item"><span class="symbol-poly"></span> Temperature Zones</div>
        <div class="legend-item"><span class="symbol-poly"></span> Ramallah Boundary</div>

    </div>
</div>

<script>
/* ---------------- MAP ---------------- */
var map = L.map("map").setView([31.903, 35.203], 11);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
L.control.scale({ imperial: false }).addTo(map);

var layers = {};
var control = L.control.layers({}, {}, { collapsed: false }).addTo(map);


/* ----------- LOAD LAYERS ------------ */
function loadLayer(file, name, color = "blue") {
    $.getJSON(file, function(data) {

        var layer = L.geoJson(data, {
            style: function () {
                return { color: color, weight: 1, fillOpacity: 0.5 };
            }
        });

        layer.addTo(map);

        layers[name] = layer;
        control.addOverlay(layer, name);

        addOpacitySlider(name);
    });
}


/* ----------- OPACITY SLIDERS ----------- */
function addOpacitySlider(layerName) {
    let container = document.getElementById("opacity-controls");

    container.innerHTML += `
        <div class="opacity-item">
            <label>${layerName}</label>
            <input type="range" min="0" max="1" step="0.1" value="0.5"
            onchange="layers['${layerName}'].setStyle({fillOpacity: this.value, opacity: this.value})">
        </div>
    `;
}


/* ----------- LOAD ALL LAYERS ----------- */
loadLayer("Agricultural_Land.geojson", "Agricultural Land", "green");
loadLayer("Annexation_Wall.geojson", "Annexation Wall", "black");
loadLayer("Approved_Urban_Master_Plans_super_simplified.geojson", "Master Plans", "purple");
loadLayer("Areas_totaly_closed_by_the_wall.geojson", "Closed Areas", "orange");
loadLayer("Built_up.geojson", "Built-up Areas", "brown");
loadLayer("Quarries.geojson", "Quarries", "gray");
loadLayer("Ramallah.geojson", "Ramallah Boundary", "red");
loadLayer("Roads.geojson", "Roads", "yellow");
loadLayer("Schools.geojson", "Schools", "blue");
loadLayer("Settlements.geojson", "Settlements", "darkred");
loadLayer("Streams.geojson", "Streams", "cyan");
loadLayer("Temperature.geojson", "Temperature Zones", "pink");
loadLayer("Wells.geojson", "Wells", "aqua");


/* ----------- LEGEND TOGGLE ----------- */
document.getElementById("legend-title").onclick = function () {
    let c = document.getElementById("legend-content");

    if (c.style.display === "none") {
        c.style.display = "block";
        this.innerHTML = "Legend ‚ñ≤";
    } else {
        c.style.display = "none";
        this.innerHTML = "Legend ‚ñº";
    }
};

/* ----------- OPACITY DROPDOWN ----------- */
document.getElementById("opacity-title").onclick = function () {
    let c = document.getElementById("opacity-content");

    if (c.style.display === "none") {
        c.style.display = "block";
        this.innerHTML = "Transparency ‚ñ≤";
    } else {
        c.style.display = "none";
        this.innerHTML = "Transparency ‚ñº";
    }
};
</script>

</body>
</html>
