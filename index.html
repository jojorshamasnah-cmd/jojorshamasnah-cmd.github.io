<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ramallah WebGIS</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { height: 100vh; width: 100%; }

        /* توسيط السكيل */
        .leaflet-control-scale {
            margin: 0 auto !important;
            left: 50% !important;
            transform: translateX(-50%);
        }

        /* صندوق الشفافية */
        #opacityBox {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 6px;
            z-index: 9999;
            width: 160px;
        }

        /* الليجند */
        #legend {
            position: absolute;
            bottom: 60px;
            left: 20px;
            background: white;
            padding: 10px;
            border-radius: 6px;
            z-index: 9999;
            width: 180px;
        }

        #legend div {
            margin-bottom: 6px;
        }

        .legend-color-box {
            width: 14px;
            height: 14px;
            display: inline-block;
            margin-right: 5px;
        }
    </style>
</head>

<body>

<div id="map"></div>

<!-- صندوق التحكم بالشفافية -->
<div id="opacityBox">
    <h4>Layer Opacity</h4>
    <select id="opacityLayer"></select>
    <input type="range" id="opacitySlider" min="0" max="1" step="0.1" value="1">
</div>

<!-- الليجند -->
<div id="legend">
    <h4>Legend</h4>
    <div id="legendItems"></div>
</div>

<script>

var map = L.map("map").setView([31.903, 35.203], 11);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19
}).addTo(map);

// مركز السكيل
L.control.scale({
    imperial: false,
    position: "bottomleft"
}).addTo(map);

// ------------- طبقات -------------
var layers = {};
var layerColors = {
    "Agricultural Land": "green",
    "Annexation Wall": "black",
    "Master Plans": "purple",
    "Closed Areas": "orange",
    "Built-up Areas": "brown",
    "Quarries": "gray",
    "Ramallah Boundary": "red",
    "Roads": "yellow",
    "Schools": "blue",
    "Settlements": "darkred",
    "Streams": "cyan",
    "Temperature": "pink",
    "Wells": "aqua"
};

var control = L.control.layers({}, {}, { collapsed: false }).addTo(map);

// تحميل طبقة GeoJSON
function loadLayer(filename, layerName) {
    $.getJSON(filename, function(data) {
        var layer = L.geoJson(data, {
            style: { color: layerColors[layerName], weight: 1, fillOpacity: 0.3 }
        });

        layers[layerName] = layer;
        layer.addTo(map);

        control.addOverlay(layer, layerName);

        // إضافة إلى قائمة الشفافية
        $("#opacityLayer").append(`<option value="${layerName}">${layerName}</option>`);

        // إضافة إلى الليجند
        $("#legendItems").append(`
            <div>
                <span class="legend-color-box" style="background:${layerColors[layerName]}"></span>
                ${layerName}
            </div>
        `);
    });
}

// تحميل كل الطبقات
loadLayer("Agricultural_Land.geojson", "Agricultural Land");
loadLayer("Annexation_Wall.geojson", "Annexation Wall");
loadLayer("Approved_Urban_Master_Plans_super_simplified.geojson", "Master Plans");
loadLayer("Areas_totaly_closed_by_the_wall.geojson", "Closed Areas");
loadLayer("Built_up.geojson", "Built-up Areas");
loadLayer("Quarries.geojson", "Quarries");
loadLayer("Ramallah.geojson", "Ramallah Boundary");
loadLayer("Roads.geojson", "Roads");
loadLayer("Schools.geojson", "Schools");
loadLayer("Settlements.geojson", "Settlements");
loadLayer("Streams.geojson", "Streams");
loadLayer("Temperature.geojson", "Temperature");
loadLayer("Wells.geojson", "Wells");

// ----------- التحكم بالشفافية -----------
$("#opacitySlider").on("input", function() {
    var selected = $("#opacityLayer").val();
    if (layers[selected]) {
        layers[selected].setStyle({ fillOpacity: this.value, opacity: this.value });
    }
});

</script>

</body>
</html>
