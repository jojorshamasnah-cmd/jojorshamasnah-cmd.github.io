<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ramallah WebGIS</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { height: 100vh; width: 100%; }

        /* Center scale */
        .leaflet-control-scale {
            margin: 0 auto !important;
            left: 50% !important;
            transform: translateX(-50%);
        }

        /* Opacity box */
        #opacityControl {
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: white;
            padding: 10px;
            border-radius: 6px;
            z-index: 9999;
            max-height: 90vh;
            overflow-y: auto;
            width: 200px;
        }

        #legend {
            position:absolute; 
            bottom:20px; 
            right:20px;
            background:white; 
            padding:10px; 
            border-radius:6px; 
            z-index:9999;
        }
    </style>
</head>

<body>

<div id="map"></div>

<!-- Opacity Control -->
<div id="opacityControl">
    <h4 style="margin: 0 0 10px 0;">Layer Opacity</h4>
</div>

<!-- Legend -->
<div id="legend">
    <h4>Legend</h4>
    <div id="legendItems"></div>
</div>

<script>

var map = L.map("map").setView([31.903, 35.203], 11);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19
}).addTo(map);

// Centered scale
L.control.scale({
    imperial: false,
    position: "bottomleft"
}).addTo(map);

// Layers dictionary
var layers = {};

// Legend Function
function addLegendItem(name, color){
    var div = document.getElementById("legendItems");
    div.innerHTML += `
        <div style="margin-bottom:5px;">
            <span style="display:inline-block; width:15px; height:15px; 
                         background:${color}; margin-right:5px;
                         border:1px solid #000;"></span> ${name}
        </div>
    `;
}

// Add Opacity Slider
function addOpacitySlider(name, layer) {
    var container = document.getElementById("opacityControl");

    var div = document.createElement("div");
    div.style.marginBottom = "10px";

    div.innerHTML = `
        <label style="font-size:14px;"><b>${name}</b></label><br>
        <input type="range" min="0" max="1" step="0.1" value="0.6"
               oninput="layers['${name}'].setStyle({fillOpacity: this.value, opacity: this.value});">
    `;

    container.appendChild(div);
}

// Load Layer Function
function loadLayer(filename, layerName, color="blue") {
    $.getJSON(filename, function(data) {
        
        var layer = L.geoJson(data, {
            style: { color: color, weight: 1, fillOpacity: 0.6 }
        });

        layers[layerName] = layer;
        layer.addTo(map);
        control.addOverlay(layer, layerName);

        // Add sliders + legend
        addOpacitySlider(layerName, layer);
        addLegendItem(layerName, color);
    });
}

// Layer Control
var control = L.control.layers({}, {}, { collapsed: false }).addTo(map);

// Bring layer to front when activated
map.on("overlayadd", function(e){
    e.layer.bringToFront();
});


// Load all layers
loadLayer("Agricultural_Land.geojson", "Agricultural Land", "green");
loadLayer("Annexation_Wall.geojson", "Annexation Wall", "black");
loadLayer("Approved_Urban_Master_Plans_super_simplified.geojson", "Master Plans", "purple");
loadLayer("Areas_totaly_closed_by_the_wall.geojson", "Closed Areas", "orange");
loadLayer("Built_up.geojson", "Built-up Areas", "brown");
loadLayer("Quarries.geojson", "Quarries", "gray");
loadLayer("Ramallah.geojson", "Ramallah Boundary", "red");
loadLayer("Roads.geojson", "Roads", "yellow");
loadLayer("Schools.geojson", "Schools", "blue");
loadLayer("Settlements.geojson", "Settlements", "darkred");
loadLayer("Streams.geojson", "Streams", "cyan");
loadLayer("Temperature.geojson", "Temperature", "pink");
loadLayer("Wells.geojson", "Wells", "aqua");

</script>

</body>
</html>
